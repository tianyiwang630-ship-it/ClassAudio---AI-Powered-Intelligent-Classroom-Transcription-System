# 课堂主题功能说明

## 功能概述

新增课堂主题设置功能，用户可以在开始录音前输入课堂主题，系统将自动使用 LLM 生成相关专业词汇，提高转写准确度。

---

## 使用流程

### 1. 输入课堂主题

在页面顶部的"课堂主题"输入框中，输入本节课的主题。

**示例：**
- `Transformer architecture`
- `机器学习基础`
- `量子计算原理`
- `数据库系统设计`

### 2. 生成专业词汇

点击"设置主题"按钮（或按回车键），系统将：
- 调用 LLM 分析课堂主题
- 生成至少 30 个相关专业术语
- 自动设置到转写引擎

**生成时间：** 通常需要 5-15 秒

### 3. 开始录音

主题设置成功后，点击"开始录音"即可开始使用。

转写引擎将使用生成的专业词汇作为提示词，提高专业术语的识别准确度。

---

## 技术实现

### 后端

1. **关键词生成模块** ([src/agent/keywords.py](src/agent/keywords.py))
   - 使用 DeepSeek V3 模型
   - 基于预设的 prompt 模板
   - 输出标准英文专业术语列表

2. **API 端点**
   - `POST /api/keywords/generate` - 根据主题生成专业词汇
   - `POST /api/keywords/set` - 手动设置专业词汇

3. **音频服务集成**
   - [audio_service.py:284-287](src/services/audio_service.py#L284-L287) - `set_prof_words()` 方法
   - 动态替换默认的 `PROF_WORDS`
   - 同时应用于 partial 和 final 解码

### 前端

1. **界面组件**
   - 主题输入框
   - 设置按钮（带加载状态）
   - 提示信息（显示当前状态）

2. **用户体验**
   - 输入框回车键快捷提交
   - 设置后自动禁用输入
   - 实时状态反馈
   - Toast 通知提示

3. **响应式设计**
   - 移动端自动垂直布局
   - 输入框和按钮自适应宽度

---

## 专业词汇生成原理

### Prompt 模板

系统使用精心设计的 prompt 模板，要求 LLM：

1. 生成开场句：`"This lecture discusses ..."`
2. 列出关键技术术语（至少 30 个）
3. 使用标准学术拼写
4. 避免重复和近义词
5. **强制使用英文输出**（即使输入是中文）

### 示例

**输入：** `Transformer architecture`

**输出：**
```
This lecture discusses large language models and the Transformer architecture.

Key technical terms include:
Transformer architecture, attention mechanism,
self-attention, scaled dot-product attention,
multi-head attention, attention weights,
query, key, value,
encoder, decoder, encoder-decoder architecture,
...

All technical terms should be transcribed accurately using their standard spelling.
```

---

## 注意事项

1. **主题设置时机**
   - **推荐：** 开始录音**之前**设置，所有内容都使用新词汇
   - **支持：** 录音过程中设置，从**下一句话**开始生效
   - **注意：** 正在转写的当前句子不会受影响

2. **网络要求**
   - 需要连接到 LLM API
   - 生成过程需要网络访问

3. **可选功能**
   - 不设置主题也可以正常录音
   - 系统会使用默认通用提示词（基础学术转写）

4. **主题语言**
   - 可以使用任何语言输入主题
   - LLM 会自动生成英文专业术语列表

---

## 故障排查

### 生成失败

**可能原因：**
- LLM API 连接失败
- API 密钥无效
- 网络超时

**解决方法：**
1. 检查网络连接
2. 查看浏览器控制台错误信息
3. 检查后端日志：`logs/audio_service.log`

### 转写准确度未提升

**可能原因：**
- 主题与实际课程内容不符
- 生成的专业词汇不够精准

**解决方法：**
1. 使用更具体的主题描述
2. 使用英文主题可能效果更好
3. 多次尝试不同的主题表述

---

## 文件清单

### 新增文件
- `src/agent/keywords.py` - 专业词汇生成模块

### 修改文件
- `src/services/audio_service.py` - 添加动态 prof_words 支持
- `src/api/server.py` - 添加关键词生成 API
- `frontend/index.html` - 添加主题输入界面
- `frontend/app.js` - 添加主题设置逻辑
- `frontend/styles.css` - 添加主题面板样式

---

## 相关文档

- [快速启动指南](快速启动指南.md)
- [日志系统说明](日志系统说明.md)
- [转写停止问题修复](转写停止问题修复.md)
